import{l as e}from"./BKfStdPn.js";import{u as t,q as r}from"./BQmdU6t6.js";import{e as a}from"#entry";import{A as u,ab as i,l,ac as o,z as n,v as s}from"./TenLCVZ2.js";import"@nuxt/kit";import"./C13ThLRp.js";import"./CVUkmZDd.js";const d=u({name:"ContentQuery",props:{path:{type:String,required:!1,default:void 0},only:{type:Array,required:!1,default:void 0},without:{type:Array,required:!1,default:void 0},where:{type:Object,required:!1,default:void 0},sort:{type:Object,required:!1,default:void 0},limit:{type:Number,required:!1,default:void 0},skip:{type:Number,required:!1,default:void 0},locale:{type:String,required:!1,default:void 0},find:{type:String,required:!1,default:void 0}},async setup(u){const{path:i,only:l,without:d,where:p,sort:f,limit:v,skip:h,locale:y,find:m}=o(u),c=n(()=>i.value?.includes("/_")),w=!a().public.content.experimental.advanceQuery;s(()=>u,()=>g(),{deep:!0});const q=e=>w?e?.surround?e.surround:e?._id||Array.isArray(e)?e:e?.result:e.result,{data:b,refresh:g}=await t(`content-query-${e(u)}`,()=>{let e;return e=i.value?r(i.value):r(),l.value&&(e=e.only(l.value)),d.value&&(e=e.without(d.value)),p.value&&(e=e.where(p.value)),f.value&&(e=e.sort(f.value)),v.value&&(e=e.limit(v.value)),h.value&&(e=e.skip(h.value)),y.value&&(e=e.where({_locale:y.value})),"one"===m.value?e.findOne().then(q):"surround"===m.value&&i.value?w?e.findSurround(i.value):e.withSurround(i.value).findOne().then(q):e.find().then(q)});return{isPartial:c,data:b,refresh:g}},render(e){const t=i(),{data:r,refresh:a,isPartial:u,path:o,only:n,without:s,where:d,sort:p,limit:f,skip:v,locale:h,find:y}=e,m={path:o,only:n,without:s,where:d,sort:p,limit:f,skip:v,locale:h,find:y};if("one"===m.find){if(!r&&t?.["not-found"])return t["not-found"]({props:m,...this.$attrs});if(t?.empty&&"markdown"===r?._type&&!r?.body?.children.length)return t.empty({props:m,...this.$attrs})}else if((!r||!r.length)&&t?.["not-found"])return t["not-found"]({props:m,...this.$attrs});if(t?.default)return t.default({data:r,refresh:a,isPartial:u,props:m,...this.$attrs});return c="default",w={data:r,props:m,isPartial:u},l("pre",null,JSON.stringify({message:"You should use slots with <ContentQuery>!",slot:c,data:w},null,2));var c,w}});export{d as default};
